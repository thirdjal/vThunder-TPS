{
	"$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json",
	"contentVersion": "1.0.0.0",
	"parameters": {
		"vmName": {
			"metadata": {
				"description": "Name of the vThunder appliance"
			},
			"type": "string"
		},
		"vmSize": {
			"defaultValue": "Standard_D3_v2",
			"metadata": {
				"description": "Size of the VM"
			},
			"type": "string",
			"allowedValues": [
				"Standard_A3",
				"Standard_A4",
				"Standard_A6",
				"Standard_A7",
				"Standard_A8",
				"Standard_A10",
				"Standard_D2",
				"Standard_D3",
				"Standard_D4",
				"Standard_D11",
				"Standard_D12",
				"Standard_D13",
				"Standard_D2_v2",
				"Standard_D3_v2",
				"Standard_D4_v2",
				"Standard_D5_v2",
				"Standard_D11_v2",
				"Standard_D12_v2",
				"Standard_D13_v2"
			]
		},
		"offer": {
			"allowedValues": [
				"vthunder_byol",
				"vthunder_10mbps",
				"vthunder_50mbps",
				"vthunder_100mbps",
				"vthunder_200mbps",
				"vthunder_500mbps"
			],
			"defaultValue": "vthunder_byol",
			"metadata": {
				"description": "Offer version and type"
			},
			"type": "string"
		},
		"vnet1Name": {
			"type": "string",
			"metadata": {
				"description": "Name of the VNet for Primary interface"
			}
		},
		"subnet1Name": {
			"type": "string",
			"metadata": {
				"description": "Name of the Subnet for Primary interface"
			}
		},
		"subnet1IpAddress": {
			"type": "string",
			"metadata": {
				"description": "IP address for Primary interface"
			}
		},
		"vnet2Name": {
			"type": "string",
			"metadata": {
				"description": "Name of the VNet for Secondary interface"
			}
		},
		"subnet2Name": {
			"type": "string",
			"metadata": {
				"description": "Name of the Subnet for Secondary interface"
			}
		},
		"subnet2IpAddress": {
			"type": "string",
			"metadata": {
				"description": "IP address for Secondary interface"
			}
		}
	},
	"variables": {
		"apiVersion": "2015-06-15",
		"baseName": "[parameters('vmName')]",
		"imageOffer": "[parameters('offer')]",
		"imagePublisher": "a10networks",
		"imageSKU": "a10-vthunder-adc",
		"location": "[resourceGroup().location]",
		"nic1Suffix": "ethernet1",
		"nic1Name": "[concat(variables('baseName'),'-',variables('nic1Suffix'))]",
		"nic2Suffix": "ethernet2",
		"nic2Name": "[concat(variables('baseName'),'-',variables('nic2Suffix'))]",
		"adminUsername": "[uniqueString(subscription().subscriptionId)]",
		"adminPassword": "79+md2,xTev*F%2pzu}[4mF442ieLDcT(TwRN7kji?,W(mvn3Y",
		"computerName": "[parameters('vmName')]",
		"storageAccountName": "[concat(uniquestring(resourceGroup().id), 'vthunder')]",
	    "storageAccountType": "Standard_LRS",
		"subnet1Name": "[parameters('subnet1Name')]",
		"subnet1IpAddress": "[parameters('subnet1IpAddress')]",
		"subnet1Id": "[concat(variables('vnet1Id'),'/subnets/', variables('subnet1Name'))]",
		"subnet2Name": "[parameters('subnet2Name')]",
		"subnet2IpAddress": "[parameters('subnet2IpAddress')]",
		"subnet2Id": "[concat(variables('vnet2Id'),'/subnets/', variables('subnet2Name'))]",
		"vnet1Id": "[resourceId(resourceGroup().name, 'Microsoft.Network/virtualNetworks', parameters('vnet1Name'))]",
		"vnet2Id": "[resourceId(resourceGroup().name, 'Microsoft.Network/virtualNetworks', parameters('vnet2Name'))]",
		"OSDiskName": "[parameters('vmName')]"
	},
	"resources": [
	    {
	      "type": "Microsoft.Storage/storageAccounts",
	      "name": "[variables('storageAccountName')]",
	      "apiVersion": "[variables('apiVersion')]",
	      "location": "[resourceGroup().location]",
	      "properties": {
	        "accountType": "[variables('storageAccountType')]"
	      }
	    },
		{
			"type": "Microsoft.Network/networkInterfaces",
			"name": "[variables('nic1Name')]",
			"location": "[variables('location')]",
			"apiVersion": "[variables('apiVersion')]",
			"properties": {
				"enableIPForwarding": true,
				"ipConfigurations": [
					{
						"name": "[concat(variables('nic1Name'),'-IpConfig')]",
						"properties": {
							"privateIPAddress": "[variables('subnet1IpAddress')]",
							"privateIPAllocationMethod": "Static",
							"subnet": {
								"id": "[variables('subnet1Id')]"
							}
						}
					}
				]
			}
		},
		{
			"type": "Microsoft.Network/networkInterfaces",
			"name": "[variables('nic2Name')]",
			"location": "[variables('location')]",
			"apiVersion": "[variables('apiVersion')]",
			"properties": {
				"enableIPForwarding": true,
				"ipConfigurations": [
					{
						"name": "[concat(variables('nic2Name'),'-IpConfig')]",
						"properties": {
							"privateIPAddress": "[variables('subnet2IpAddress')]",
							"privateIPAllocationMethod": "Static",
							"subnet": {
								"id": "[variables('subnet2Id')]"
							}
						}
					}
				]
			}
		},
		{
			"apiVersion": "[variables('apiVersion')]",
			"type": "Microsoft.Compute/virtualMachines",
			"name": "[parameters('vmName')]",
			"location": "[resourceGroup().location]",
			"dependsOn": [
		        "[concat('Microsoft.Storage/storageAccounts/', variables('storageAccountName'))]",
				"[concat('Microsoft.Network/networkInterfaces/', variables('nic1Name'))]",
				"[concat('Microsoft.Network/networkInterfaces/', variables('nic2Name'))]"
			],
			"properties": {
				"hardwareProfile": {
					"vmSize": "[parameters('vmSize')]"
				},
				"osProfile": {
					"computerName": "[variables('vmName')]",
					"adminUsername": "[variables('adminUsername')]",
					"adminPassword": "[variables('adminPassword')]"
				},
				"storageProfile": {
					"imageReference": {
						"publisher": "[variables('imagePublisher')]",
						"offer": "[variables('imageOffer')]",
						"sku": "[variables('imageSKU')]",
						"version": "latest"
					},
					"osDisk": {
						"name": "osdisk",
						"vhd": {
							"uri": "[concat('http://',variables('storageAccountName'),'.blob.core.windows.net/vhds/',variables('OSDiskName'),'.vhd')]"
						},
						"caching": "ReadWrite",
						"createOption": "FromImage"
					}
				},
				"networkProfile": {
					"networkInterfaces": [
						{
							"id": "[resourceId('Microsoft.Network/networkInterfaces',variables('nic1Name'))]",
							"properties": {
								"primary": true
							}
						},
						{
							"id": "[resourceId('Microsoft.Network/networkInterfaces',variables('nic2Name'))]",
							"properties": {
								"primary": false
							}
						}
					]
				},
				"diagnosticsProfile": {
					"bootDiagnostics": {
						"enabled": "true",
						"storageUri": "[concat('http://',variables('storageAccountName'),'.blob.core.windows.net')]"
					}
				}
			}
		}
	],
	"outputs": {
		"virtualMachine": {
			"value": "[resourceId('Microsoft.Compute/virtualMachines',parameters('vmName'))]",
			"type": "string"
		}
	}
}